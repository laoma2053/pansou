# ðŸš€ PanSou å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆ v2.0

## ðŸ“‹ é‡è¦è¯´æ˜Ž

âš ï¸  **ç«¯å£ç»Ÿä¸€è¯´æ˜Ž**ï¼š
- åŽŸä½œè€…é•œåƒä½¿ç”¨ **8888ç«¯å£**
- æ‰€æœ‰è®¿é—®éƒ½åº”è¯¥ä½¿ç”¨ `http://IP:8888`
- ä¹‹å‰çš„8080ç«¯å£é…ç½®æ˜¯é”™è¯¯çš„

## ðŸŽ¯ éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆAï¼šä½¿ç”¨åŽŸä½œè€…é•œåƒ + æ‚¨çš„UIï¼ˆæŽ¨èï¼‰
- âœ… ç¨³å®šæ€§é«˜ï¼ŒåŽŸä½œè€…ç»´æŠ¤
- âœ… éƒ¨ç½²å¿«é€Ÿ
- âœ… åŒ…å«æ‚¨çš„UIç•Œé¢

### æ–¹æ¡ˆBï¼šå®Œå…¨è‡ªå»ºé•œåƒ
- âš ï¸ éœ€è¦è‡ªå·±ç»´æŠ¤
- âš ï¸ æž„å»ºæ—¶é—´é•¿
- âœ… å®Œå…¨æŽ§åˆ¶

## ðŸš€ æ–¹æ¡ˆAï¼šå¿«é€Ÿéƒ¨ç½²ï¼ˆæŽ¨èï¼‰

### 1. æ¸…ç†çŽ¯å¢ƒ
```bash
# åœæ­¢æ‰€æœ‰ç›¸å…³å®¹å™¨
docker-compose down
docker stop pansou 2>/dev/null || true
docker rm pansou 2>/dev/null || true

# æ¸…ç†é…ç½®
rm -f docker-compose.yml .env
```

### 2. åˆ›å»ºæ­£ç¡®çš„é…ç½®æ–‡ä»¶
```bash
cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  pansou:
    image: ghcr.io/fish2018/pansou:latest
    container_name: pansou
    restart: unless-stopped
    ports:
      - "8888:8888"
    environment:
      - PORT=8888
      - CHANNELS=tgsearchers2,SharePanBaidu,yunpanxunlei,tianyifc,BaiduCloudDisk
      - CACHE_ENABLED=true
      - CACHE_PATH=/app/cache
      - CACHE_MAX_SIZE=100
      - CACHE_TTL=60
    volumes:
      - pansou-cache:/app/cache
      - ./web:/app/web:ro
    networks:
      - pansou-network
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8888"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  pansou-cache:
    driver: local

networks:
  pansou-network:
    driver: bridge
EOF
```

### 3. æ£€æŸ¥webç›®å½•
```bash
# ç¡®ä¿webç›®å½•å­˜åœ¨ä¸”åŒ…å«æ‚¨çš„UIæ–‡ä»¶
if [ ! -d "./web" ]; then
    echo "âŒ webç›®å½•ä¸å­˜åœ¨ï¼Œè¯·ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•"
    exit 1
fi

if [ ! -f "./web/index.html" ]; then
    echo "âŒ ç¼ºå°‘index.htmlæ–‡ä»¶"
    exit 1
fi

echo "âœ… webç›®å½•æ£€æŸ¥é€šè¿‡"
ls -la ./web/
```

### 4. å¯åŠ¨æœåŠ¡
```bash
# æ‹‰å–æœ€æ–°é•œåƒ
docker-compose pull

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# ç­‰å¾…å¯åŠ¨
echo "ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 20
```

### 5. éªŒè¯éƒ¨ç½²
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep pansou

# æ£€æŸ¥æŒ‚è½½
docker exec pansou ls -la /app/web/

# æµ‹è¯•è®¿é—®
curl -I http://localhost:8888/
```

## ðŸš€ æ–¹æ¡ˆBï¼šè‡ªå»ºé•œåƒ

### 1. ä¿®æ”¹Dockerfileï¼ˆç¡®ä¿åŒ…å«æ‚¨çš„UIï¼‰
```dockerfile
# æž„å»ºé˜¶æ®µ
FROM golang:1.23-alpine AS builder

# å®‰è£…æž„å»ºä¾èµ–
RUN apk add --no-cache git ca-certificates tzdata

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY go.mod go.sum ./

# ä¸‹è½½ä¾èµ–
RUN go mod download

# å¤åˆ¶æºä»£ç 
COPY . .

# æž„å»ºåº”ç”¨
RUN CGO_ENABLED=0 GOOS=linux go build -ldflags="-w -s" -o pansou .

# è¿è¡Œé˜¶æ®µ
FROM alpine:latest

# å®‰è£…è¿è¡Œä¾èµ–
RUN apk --no-cache add ca-certificates wget tzdata && \
    wget -O /etc/apk/keys/sgerrand.rsa.pub https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub && \
    wget https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.34-r0/glibc-2.34-r0.apk && \
    apk add glibc-2.34-r0.apk

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# ä»Žæž„å»ºé˜¶æ®µå¤åˆ¶åº”ç”¨
COPY --from=builder /app/pansou .

# å¤åˆ¶é…ç½®æ–‡ä»¶
COPY --from=builder /app/config ./config

# å¤åˆ¶æ‚¨çš„UIæ–‡ä»¶
COPY --from=builder /app/web ./web

# è®¾ç½®æƒé™
RUN chmod +x pansou

# æš´éœ²ç«¯å£
EXPOSE 8888

# è®¾ç½®çŽ¯å¢ƒå˜é‡
ENV PORT=8888

# è¿è¡Œåº”ç”¨
CMD ["./pansou"]
```

### 2. é…ç½®docker-compose
```bash
cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  pansou:
    build: .
    container_name: pansou
    restart: unless-stopped
    ports:
      - "8888:8888"
    environment:
      - PORT=8888
      - CHANNELS=tgsearchers2,SharePanBaidu,yunpanxunlei,tianyifc,BaiduCloudDisk
      - CACHE_ENABLED=true
      - CACHE_PATH=/app/cache
      - CACHE_MAX_SIZE=100
      - CACHE_TTL=60
    volumes:
      - pansou-cache:/app/cache
    networks:
      - pansou-network

volumes:
  pansou-cache:
    driver: local

networks:
  pansou-network:
    driver: bridge
EOF
```

### 3. æž„å»ºå’Œå¯åŠ¨
```bash
# æž„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨æœåŠ¡
docker-compose up -d
```

## ðŸ“ è®¿é—®åœ°å€

éƒ¨ç½²å®ŒæˆåŽï¼š
- **æœ¬åœ°è®¿é—®**: http://localhost:8888/
- **æœåŠ¡å™¨è®¿é—®**: http://æ‚¨çš„æœåŠ¡å™¨IP:8888/
- **APIæŽ¥å£**: http://æ‚¨çš„æœåŠ¡å™¨IP:8888/api/search

## ðŸ”§ æ•…éšœæŽ’é™¤

### 1. æ£€æŸ¥å®¹å™¨æ—¥å¿—
```bash
docker-compose logs -f pansou
```

### 2. æ£€æŸ¥æ–‡ä»¶æŒ‚è½½
```bash
docker exec pansou ls -la /app/web/
```

### 3. æµ‹è¯•API
```bash
curl http://localhost:8888/api/health
```

### 4. é‡æ–°éƒ¨ç½²
```bash
docker-compose down
docker-compose up -d --force-recreate
```

## ðŸ›¡ï¸ é˜²ç«å¢™é…ç½®

```bash
# å¼€æ”¾8888ç«¯å£ï¼ˆä¸æ˜¯8080ï¼ï¼‰
sudo ufw allow 8888/tcp
sudo ufw reload
```

---

**é‡ç‚¹æé†’**ï¼šæ‰€æœ‰è®¿é—®éƒ½ä½¿ç”¨ **8888ç«¯å£**ï¼Œä¸æ˜¯8080ï¼
